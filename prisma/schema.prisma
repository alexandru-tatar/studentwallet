/// https://github.com/prisma/prisma/releases/tag/6.12.0
generator client {
  provider        = "prisma-client"
  output          = "../src/generated/prisma"
  previewFeatures = ["nativeDistinct", "relationJoins"]
  engineType      = "client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["campus_wallet"]
}

/// https://www.prisma.io/docs/orm/reference/prisma-schema-reference#datasource
model Student {
  id                  Int           @id @default(autoincrement())
  version             Int           @default(0)
  matriculationNumber String        @unique @map("matriculation_number")
  firstName           String        @map("first_name")
  lastName            String        @map("last_name")
  email               String        @unique
  semester            Int
  createdAt           DateTime      @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt           DateTime      @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  transactions        Transaction[]
  wallet              Wallet?

  @@map("student")
  @@schema("campus_wallet")
}

model Wallet {
  id                  Int       @id @default(autoincrement())
  version             Int       @default(0)
  balance             Decimal   @default(0) @db.Decimal(12, 2)
  autoReloadEnabled   Boolean   @default(false) @map("auto_reload_enabled")
  autoReloadThreshold Decimal   @default(0) @map("auto_reload_threshold") @db.Decimal(12, 2)
  autoReloadAmount    Decimal   @default(0) @map("auto_reload_amount") @db.Decimal(12, 2)
  lastReloaded        DateTime? @map("last_reloaded") @db.Timestamp(6)
  studentId           Int       @unique @map("student_id")
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt           DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  student             Student   @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("wallet")
  @@schema("campus_wallet")
}

model Transaction {
  id         Int             @id @default(autoincrement())
  amount     Decimal         @db.Decimal(12, 2)
  type       TransactionType
  reference  String?
  location   String?
  recordedAt DateTime        @default(now()) @map("recorded_at") @db.Timestamp(6)
  studentId  Int             @map("student_id")
  student    Student         @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([studentId])
  @@map("transaction")
  @@schema("campus_wallet")
}

/// https://www.prisma.io/docs/orm/reference/prisma-schema-reference#enum
enum TransactionType {
  LOAD
  SPEND
  REFUND

  @@map("transaction_type")
  @@schema("campus_wallet")
}
